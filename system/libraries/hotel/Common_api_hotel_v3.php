<?php
require_once BASEPATH . 'libraries/Common_Api_Grind.php';
/**
 * Provab Common Functionality For API Class
 *
 *
 * @package Provab
 * @subpackage provab
 * @category Libraries
 * @author Arjun J<arjun.provab@gmail.com>
 * @link http://www.provab.com
 */
abstract class Common_Api_Hotel_v3 extends Common_Api_Grind {
	function __construct($module, $api) {
          
		parent::__construct ( $module, $api );
	}
	static $app_reference = false;
	
	/**
	 *
	 * @param string $journey_number
	 *        	//onward, return ,multi-city
	 * @param string $origin_code
	 *        	origin airport code
	 * @param string $destination_code
	 *        	destination airport code
	 * @param
	 *        	date string $departure_dt Y-m-d H:i:s
	 * @param
	 *        	date string $arrival_dt Y-m-d H:i:s
	 * @param string $operator_code
	 *        	//operator code like 9W for Jet Airways
	 * @param string $operator_name
	 *        	//hotel operator name like Jet Airways
	 * @param string $hotel_number
	 *        	//hotel number
	 * @param number $no_of_stops
	 *        	// no of stops in journey
	 * @param string $cabin_class
	 *        	//class of journey like ECONOMY
	 * @param string $origine_name
	 *        	// origin city airport name
	 * @param string $destination_name
	 *        	// destination city airport name
	 * @param number $duration
	 *        	// journey duration in seconds
	 */
	protected function format_summary_array($journey_number, $origin_code, $destination_code, $departure_dt, $arrival_dt, $operator_code, $operator_name, $hotel_number, $no_of_stops, $cabin_class = NULL, $origine_name = NULL, $destination_name = NULL, $duration = NULL, $is_leg = true, $attr = array(), $org_terminal = NULL, $des_terminal = NULL, $carrier_code = NULL) {
		$CI = & get_instance ();
		
		$dts = strtotime ( $departure_dt );
		$ats = strtotime ( $arrival_dt );
		
		$departure_time = date ( 'H:i', $dts );
		$arrival_time = date ( 'H:i', $ats );
		
		$org_loc_details = $CI->db_cache_api->get_airport_details ( $origin_code);
		$des_loc_details = $CI->db_cache_api->get_airport_details ( $destination_code);
		
		if (! isset ( $origine_name ) || empty ( $origine_name )) {
			$origine_name = (empty ( $org_loc_details ['airport_city'] ) ? $origin_code : ($org_loc_details ['airport_city']));
		}
		
		if (! isset ( $destination_name ) || empty ( $destination_name )) {
			$destination_name = (empty ( $des_loc_details ['airport_city'] ) ? $destination_code : ($des_loc_details ['airport_city']));
		}
		$summary_array = array ();
		
		$summary_array ['Origin'] = array (
				'AirportCode' => $origin_code,
				'CityName' => $origine_name,
				'AirportName' => $origine_name,
				'DateTime' => $departure_dt,
				'FDTV' => strtotime ( $departure_time ) 
		); // Derive
		
		$summary_array ['Destination'] = array (
				'AirportCode' => $destination_code,
				'CityName' => $destination_name,
				'AirportName' => $destination_name,
				'DateTime' => $arrival_dt,
				'FATV' => strtotime ( $arrival_time ) 
		); // Derive
		$summary_array ['OperatorCode'] = $operator_code; // Airline code 9w
		$summary_array ['DisplayOperatorCode'] = $carrier_code;
		$summary_array ['OperatorName'] = $operator_name; // Airline name
		$summary_array ['hotelNumber'] = $hotel_number;
		$summary_array ['CabinClass'] = $cabin_class;
		$summary_array ['Attr'] = @$attr;
		return $summary_array;
	}	
	/**
	 * Read session
	 *
	 * @param string $key
	 *        	source_code
	 */
	function read_session_id($key = NULL) {
		if (empty ( $key ) == true) {
			$key = $this->source_code;
		}
		
		$ci = & get_instance ();
		$value = $ci->input->cookie ( $key, true );
		return $value;
	}
	
	/*
	 * Delete session
	 */
	function remove_session($key = NULL) {
		if (empty ( $key ) == true) {
			$key = $this->source_code;
		}
		delete_cookie ( $key );
	}
	/**
	 * Checks Booking Source is active or not
	 */
	protected  function is_active_booking_source()
	{
		$data['status'] = SUCCESS_STATUS;
		$data['message'] = array();
              
		if(valid_array($this->config) == false){
			$data['status'] = FAILURE_STATUS;
			$data['message'] = $this->booking_source.': Booking Source is not active';
		}
		return $data;
	}
}